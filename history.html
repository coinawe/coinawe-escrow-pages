<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Riwayat Transaksi</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      background-color: #0f172a;
      color: #e2e8f0;
      font-family: 'Segoe UI', sans-serif;
      padding: 20px;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    h2 {
      font-size: 1.5rem;
      color: #38bdf8;
    }
    select {
      background-color: #1e293b;
      color: #e2e8f0;
      border: 1px solid #334155;
      padding: 6px 12px;
      border-radius: 6px;
    }
    .entry {
      background-color: #1e293b;
      padding: 16px;
      margin-bottom: 12px;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);
      animation: fadeIn 0.3s ease;
    }
    .entry b {
      color: #f0f9ff;
    }
    .status {
      font-weight: bold;
      padding: 2px 6px;
      border-radius: 4px;
    }
    .status.Completed {
      background-color: #22c55e;
      color: #0f172a;
    }
    .status.Pending {
      background-color: #facc15;
      color: #0f172a;
    }
    .status.Cancelled {
      background-color: #ef4444;
      color: #fff;
    }
    .footer {
      text-align: center;
      font-size: 0.85rem;
      margin-top: 20px;
      color: #94a3b8;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>
  <header>
    <h2 id="page-title">üßæ Riwayat Escrow</h2>
    <select onchange="setLanguage(this.value)">
      <option value="id">üåê Bahasa</option>
      <option value="en">English</option>
      <option value="ru">–†—É—Å—Å–∫–∏–π</option>
    </select>
  </header>

  <div id="history">Memuat data...</div>

  <div class="footer" id="footer-text">Menampilkan transaksi berdasarkan ID pengguna.</div>

  <script>
    const translations = {
      id: {
        title: "üßæ Riwayat Escrow",
        loading: "Memuat data...",
        empty: "Tidak ada transaksi ditemukan.",
        failed: "Gagal memuat data transaksi.",
        buyer: "Pembeli",
        seller: "Penjual",
        amount: "Jumlah",
        item: "Item",
        status: "Status",
        footer: "Menampilkan transaksi berdasarkan ID pengguna.",
        statuses: {
          Completed: "Selesai",
          Pending: "Menunggu",
          Cancelled: "Dibatalkan"
        }
      },
      en: {
        title: "üßæ Escrow History",
        loading: "Loading data...",
        empty: "No transactions found.",
        failed: "Failed to load transaction data.",
        buyer: "Buyer",
        seller: "Seller",
        amount: "Amount",
        item: "Item",
        status: "Status",
        footer: "Showing transactions based on user ID.",
        statuses: {
          Completed: "Completed",
          Pending: "Pending",
          Cancelled: "Cancelled"
        }
      },
      ru: {
        title: "üßæ –ò—Å—Ç–æ—Ä–∏—è –≠—Å–∫—Ä–æ—É",
        loading: "–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...",
        empty: "–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.",
        failed: "–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ.",
        buyer: "–ü–æ–∫—É–ø–∞—Ç–µ–ª—å",
        seller: "–ü—Ä–æ–¥–∞–≤–µ—Ü",
        amount: "–°—É–º–º–∞",
        item: "–ü—Ä–µ–¥–º–µ—Ç",
        status: "–°—Ç–∞—Ç—É—Å",
        footer: "–û—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø–æ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.",
        statuses: {
          Completed: "–ó–∞–≤–µ—Ä—à–µ–Ω–æ",
          Pending: "–í –æ–∂–∏–¥–∞–Ω–∏–∏",
          Cancelled: "–û—Ç–º–µ–Ω–µ–Ω–æ"
        }
      }
    };

    let currentLang = 'id';
    const userId = new URLSearchParams(window.location.search).get("user_id") || "";
    const container = document.getElementById("history");
    const footer = document.getElementById("footer-text");

    function setLanguage(lang) {
      currentLang = lang;
      const t = translations[lang] || translations["en"];
      document.getElementById("page-title").innerText = t.title;
      footer.innerText = t.footer;
      container.innerText = t.loading;
      fetchData(t);
    }

    function fetchData(t) {
      fetch("https://script.google.com/macros/s/AKfycbywHuDI_p6ZrFJakBxZbCd4fhmc0sVeQj4vVQkSgOfP39XJXr9tbs7M0SL8VqpPjVyZ_w/exec?user_id=" + userId)
        .then(res => res.json())
        .then(data => {
          if (!data || data.length === 0) {
            container.innerHTML = `<p>${t.empty}</p>`;
            return;
          }
          container.innerHTML = '';
          data.forEach(row => {
            const statusClass = row.status;
            const statusLabel = t.statuses[row.status] || row.status;
            container
